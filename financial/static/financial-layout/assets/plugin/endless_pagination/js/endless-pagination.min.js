/**
 * Created by kelvin on 7/18/2017.
 */
!function(e){"use strict";e.fn.endlessPaginate=function(n){var t={containerSelector:".endless_container",loadingSelector:".endless_loading",moreSelector:"a.endless_more",pageSelector:".endless_page_template",pagesSelector:"a.endless_page_link",onClick:function(){},onCompleted:function(){},paginateOnScroll:!1,paginateOnScrollMargin:1,paginateOnScrollChunkSize:0},r=e.extend(t,n),i=function(e){return{key:e.attr("rel").split(" ")[0],url:e.attr("href")}};return this.each(function(){var n=e(this),t=1;if(n.on("click",r.moreSelector,function(){var n=e(this),l=n.get(0),o=n.closest(r.containerSelector),a=o.find(r.loadingSelector);if(a.is(":visible"))return!1;n.hide(),a.show();var c=i(n);if(r.onClick.apply(l,[c])!==!1){var s="querystring_key="+c.key;e.get(c.url,s,function(e){o.before(e),o.remove(),t+=1,r.onCompleted.apply(l,[c,e.trim()])})}return!1}),r.paginateOnScroll){var l=e(window),o=e(document);l.scroll(function(){if(o.height()-l.height()-l.scrollTop()<=r.paginateOnScrollMargin){var e=r.paginateOnScrollChunkSize;(!e||t%e)&&n.find(r.moreSelector).click()}})}n.on("click",r.pagesSelector,function(){var n=e(this),t=n.get(0),l=i(n);if(r.onClick.apply(t,[l])!==!1){var o=n.closest(r.pageSelector),a="querystring_key="+l.key;o.load(l.url,a,function(e){r.onCompleted.apply(t,[l,e.trim()])})}return!1})})},e.endlessPaginate=function(n){return e("body").endlessPaginate(n)}}(jQuery);